ä»é›¶å¼€å§‹é…ç½® Neovim(Nvim)
MartinLwx  æ”¶å½•äº  ç±»åˆ«
Vim-Neovim
 2023-02-08  2024-04-04  çº¦ 4665 å­—
 é¢„è®¡é˜…è¯» 10 åˆ†é’Ÿ
ä¿¡æ¯

æ›´æ–°ï¼š

    2024-04-04ï¼Œé‡å†™éƒ¨åˆ†ç« èŠ‚ï¼ŒPackage Manager ä» packer.nvim æ¢æˆäº† lazy.nvim ğŸ¤—ã€‚
        å¦‚æœä¹‹å‰è·Ÿç€æœ¬ç¯‡æ•™ç¨‹é‡‡ç”¨ packer.nvim è¿›è¡Œå®‰è£…çš„è¯ï¼Œå¯ä»¥å‚è€ƒæˆ‘è¿ç§»çš„æ—¶å€™çš„ commitï¼Œä¿®æ”¹å®Œä¹‹åè®°å¾—ç”¨ :checkhealth lazy æ£€æŸ¥ä¸‹ï¼Œå› ä¸ºè¿˜éœ€è¦åˆ é™¤ packer.nvim çš„ä¸€äº›æ—§æ–‡ä»¶

è¿›ä¸€æ­¥é˜…è¯»:

    å¦‚ä½•ä¸ºä¸€é—¨æ–°çš„ç¼–ç¨‹è¯­è¨€é…ç½® Neovim ï¼Œä»¥åŠæ”¯æŒç¬¬ä¸‰æ–¹ä»£ç æ ¼å¼åŒ–å·¥å…·ï¼Œè§ä¸‹ç¯‡æ–‡ç« 

ç‰ˆæœ¬ä¿¡æ¯

æˆ‘ä½¿ç”¨çš„æ˜¯ Macbook pro 2020 Intel ç‰ˆæœ¬ï¼Œç³»ç»Ÿç‰ˆæœ¬ä¸º macOS 14.3.1ã€‚æˆ‘çš„ Nvim ç‰ˆæœ¬ä¿¡æ¯å¦‚ä¸‹

NVIM v0.9.5
Build type: Release
LuaJIT 2.1.1710088188

   system vimrc file: "$VIM/sysinit.vim"
  fall-back for $VIM: "/usr/local/Cellar/neovim/0.9.5/share/nvim"

Run :checkhealth for more info

ä¸ºä»€ä¹ˆé€‰æ‹© Neovim

åœ¨ä½¿ç”¨ Vim ä¸€å¹´å¤šä¹‹åï¼Œæˆ‘è¶Šå‘è§‰å¾— Vim çš„é…ç½®éº»çƒ¦ï¼Œå¯åŠ¨åŠ è½½é€Ÿåº¦ä¹Ÿä¸å°½äººæ„ã€‚æˆ‘ä¹Ÿå¾ˆä¸å–œæ¬¢ Vimscript çš„å†™æ³•ï¼Œè¿™å¯¼è‡´æˆ‘å†³å®šä½¿ç”¨ Neovim(Nvim)ã€‚æˆ‘å†³å®šé‡æ–°é…ç½® Nvimã€‚ä¸ºä»€ä¹ˆä¼šæƒ³è¦é‡æ–°é…ç½®è€Œä¸æ˜¯è¿ç§»é…ç½®å‘¢ï¼Ÿå› ä¸ºæˆ‘æƒ³é¡ºä¾¿è¶ç€è¿™ä¸ªæœºä¼šï¼Œé‡æ–°å®¡è§†æˆ‘æœ¬æ¥ Vim çš„é…ç½®ï¼Œä»¥åŠå°†æœ¬æ¥ç”¨åˆ°çš„çš„æ’ä»¶æ›¿æ¢ä¸ºç°åœ¨çš„ SOTA(State-of-the-art)ã€‚æˆ‘è‡ªä»çœ‹å®Œ MIT çš„ Missing semester çš„è¯¾é…ç½®äº† ~/.vimrc ä¹‹åå°±å¾ˆé•¿æ—¶é—´éƒ½æ²¡æœ‰å†ç¼–è¾‘ ~/.vimrc æ–‡ä»¶äº†

æˆ‘è®¤ä¸ºåœ¨é…ç½® Nvim çš„æ—¶å€™å¼„æ¸…æ¥šæ¯ä¸€ä¸ªé€‰é¡¹çš„æ„æ€æ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼Œå› æ­¤æˆ‘åœ¨è¿™ç¯‡åšå®¢ä¸­ä¼šå°½é‡è§£é‡Šæ¸…æ¥šæ¯ä¸ªé€‰é¡¹çš„å«ä¹‰ï¼ŒåŒæ—¶å°†è§£é‡Šæ”¾åœ¨æ³¨é‡Šé‡Œé¢ï¼Œå³æˆ‘å°½é‡è®©æˆ‘è‡ªå·±çš„é…ç½®æ–‡ä»¶æ˜¯ self-contained è€Œä¸”å¯è¯»æ€§å¼ºçš„

    ğŸ’¡ å½“ç„¶ï¼Œè¿™éš¾å…æœ‰ç–æ¼ã€‚åˆ«å¿˜äº†æˆ‘ä»¬æ°¸è¿œå¯ä»¥åœ¨ Nvim é‡Œé¢è¾“å…¥ :h <name> æ¥çœ‹åˆ°æ›´ä¸ºè¯¦ç»†çš„è§£é‡Š

    ğŸ’¡ è¯¥ç¯‡åšå®¢å‡å®šä½ å¯¹ Vim æœ‰åŸºæœ¬äº†è§£

Nvim é…ç½®åŸºç¡€çŸ¥è¯†
Lua è¯­è¨€

åœ¨é…ç½® Nvim çš„æ—¶å€™ï¼Œæˆ‘ä¼šå°½å¯èƒ½ç”¨ Lua è¯­è¨€å†™é…ç½®ï¼Œå› æ­¤ä½ æœ‰å¿…è¦äº†è§£ä¸€ä¸‹ Lua çš„åŸºæœ¬è¯­æ³•å’Œè¯­ä¹‰ã€‚å¯ä»¥å¿«é€Ÿæµè§ˆä¸€ä¸‹ Learn Lua in Y minutes äº†è§£å¤§æ¦‚
é…ç½®æ–‡ä»¶è·¯å¾„

Nvim çš„é…ç½®ç›®å½•åœ¨ ~/.config/nvim ä¸‹ã€‚åœ¨ Linux/Mac ç³»ç»Ÿä¸Šï¼ŒNvim ä¼šé»˜è®¤è¯»å– ~/.config/nvim/init.lua æ–‡ä»¶ï¼Œç†è®ºä¸Šæ¥è¯´å¯ä»¥å°†æ‰€æœ‰é…ç½®çš„ä¸œè¥¿éƒ½æ”¾åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œé¢ï¼Œä½†è¿™æ ·ä¸æ˜¯ä¸€ä¸ªå¥½çš„åšæ³•ï¼Œå› æ­¤æˆ‘åˆ’åˆ†ä¸åŒçš„æ–‡ä»¶å’Œç›®å½•æ¥åˆ†ç®¡ä¸åŒçš„é…ç½®

é¦–å…ˆçœ‹ä¸‹æŒ‰ç…§æœ¬ç¯‡æ•™ç¨‹é…ç½® Nvim ä¹‹åï¼Œç›®å½•ç»“æ„çœ‹èµ·æ¥ä¼šæ˜¯æ€ä¹ˆæ ·â¬‡ï¸

nvim
â”œâ”€â”€ init.lua
â””â”€â”€ lua
    â”œâ”€â”€ colorscheme.lua
    â”œâ”€â”€ config
    â”‚   â””â”€â”€ nvim-cmp.lua
    â”œâ”€â”€ keymaps.lua
    â”œâ”€â”€ lsp.lua
    â”œâ”€â”€ options.lua
    â””â”€â”€ plugins.lua

è§£é‡Šå¦‚ä¸‹

    init.lua ä¸º Nvim é…ç½®çš„ Entry pointï¼Œæˆ‘ä»¬ä¸»è¦ç”¨æ¥å¯¼å…¥å…¶ä»– *.lua æ–‡ä»¶
        colorscheme.lua é…ç½®ä¸»é¢˜
        keymaps.lua é…ç½®æŒ‰é”®æ˜ å°„
        lsp.lua é…ç½® LSP
        options.lua é…ç½®é€‰é¡¹
        plugins.lua é…ç½®æ’ä»¶
    config ç”¨äºå­˜æ”¾å„ç§æ’ä»¶è‡ªèº«çš„é…ç½®ï¼Œæ–‡ä»¶åä¸ºæ’ä»¶çš„åå­—ï¼Œè¿™æ ·æ¯”è¾ƒå¥½æ‰¾ã€‚è¿™é‡Œçš„ nvim-cmp.lua å°±æ˜¯ nvim-cmp æ’ä»¶çš„é…ç½®æ–‡ä»¶
    lua ç›®å½•ã€‚å½“æˆ‘ä»¬åœ¨ Lua é‡Œé¢è°ƒç”¨ require åŠ è½½æ¨¡å—ï¼ˆæ–‡ä»¶ï¼‰çš„æ—¶å€™ï¼Œå®ƒä¼šè‡ªåŠ¨åœ¨ lua æ–‡ä»¶å¤¹é‡Œé¢è¿›è¡Œæœç´¢
        å°†è·¯å¾„åˆ†éš”ç¬¦ä» / æ›¿æ¢ä¸º .ï¼Œç„¶åå»æ‰ .lua åç¼€å°±å¾—åˆ°äº† require çš„å‚æ•°æ ¼å¼
        æ¯”å¦‚è¦å¯¼å…¥ä¸Šé¢çš„ nvim-cmp.lua æ–‡ä»¶ï¼Œå¯ä»¥ç”¨ require('config.nvim-cmp')

é€‰é¡¹é…ç½®

ä¸»è¦ç”¨åˆ°çš„å°±æ˜¯ vim.gã€vim.optã€vim.cmd ç­‰ï¼Œæˆ‘åˆ¶é€ äº†ä¸€ä¸ªå¿«é€Ÿå‚ç…§å¯¹æ¯”çš„è¡¨æ ¼
In Vim 	In Nvim 	Note
let g:foo = bar 	vim.g.foo = bar
set foo = bar 	vim.opt.foo = bar 	set foo = vim.opt.foo = true
some_vimscript 	vim.cmd(some_vimscript)
æŒ‰é”®é…ç½®

åœ¨ Nvim é‡Œé¢è¿›è¡ŒæŒ‰é”®ç»‘å®šçš„è¯­æ³•å¦‚ä¸‹ï¼Œå…·ä½“çš„è§£é‡Šå¯ä»¥çœ‹ :h vim.keymap.set

vim.keymap.set(<mode>, <key>, <action>, <opts>)

ä»é›¶å¼€å§‹é…ç½® Nvim

åœ¨é˜…è¯»äº†å‰é¢ä¸€äº›é…ç½®åŸºç¡€ä¹‹åï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥ä»å¤´å¼€å§‹ï¼Œç”±ç®€åˆ°æ˜“ä¸€æ­¥æ­¥é…ç½® Nvim äº†
å®‰è£… Nvim

æˆ‘ç”¨çš„æ˜¯ Macï¼Œç”¨ Homebrew å®‰è£… Nvim éå¸¸å®¹æ˜“ï¼Œåªè¦è¿è¡Œå¦‚ä¸‹å‘½ä»¤å³å¯1

$ brew install neovim

åœ¨å®‰è£…å®Œæˆä¹‹åï¼Œå¦‚æœ ~/.config/nvim ç›®å½•ä¸å­˜åœ¨ï¼Œåˆ›å»ºç›®å½•å¹¶æ–°å»º init.lua æ–‡ä»¶

$ mkdir ~/.config/nvim
$ mkdir ~/.config/nvim/lua
$ touch ~/.config/nvim/init.lua

    ğŸ’¡ é…ç½®æ–‡ä»¶ç¼–è¾‘ä¿å­˜ä¹‹åï¼Œé‡å¯ Nvim å°±èƒ½çœ‹åˆ°æ•ˆæœï¼Œåé¢é»˜è®¤æ¯æ¬¡å°ç« èŠ‚é…ç½®å®Œæˆåå°±é‡å¯

é€‰é¡¹é…ç½®

é€‰é¡¹é…ç½®åŠŸèƒ½ä¸€è§ˆï¼š

    é»˜è®¤é‡‡ç”¨ç³»ç»Ÿå‰ªè´´æ¿ï¼ŒåŒæ—¶æ”¯æŒé¼ æ ‡æ“æ§ Nvim
    Tab å’Œç©ºæ ¼çš„æ¢ç®—
    UI ç•Œé¢
    â€œæ™ºèƒ½â€æœç´¢

æ–°å»º ~/.config/nvim/lua/options.lua æ–‡ä»¶å¹¶åŠ å…¥å¦‚ä¸‹å†…å®¹â¬‡ï¸

-- Hint: use `:h <option>` to figure out the meaning if needed
vim.opt.clipboard = 'unnamedplus' -- use system clipboard
vim.opt.completeopt = { 'menu', 'menuone', 'noselect' }
vim.opt.mouse = 'a' -- allow the mouse to be used in Nvim

-- Tab
vim.opt.tabstop = 4 -- number of visual spaces per TAB
vim.opt.softtabstop = 4 -- number of spacesin tab when editing
vim.opt.shiftwidth = 4 -- insert 4 spaces on a tab
vim.opt.expandtab = true -- tabs are spaces, mainly because of python

-- UI config
vim.opt.number = true -- show absolute number
vim.opt.relativenumber = true -- add numbers to each line on the left side
vim.opt.cursorline = true -- highlight cursor line underneath the cursor horizontally
vim.opt.splitbelow = true -- open new vertical split bottom
vim.opt.splitright = true -- open new horizontal splits right
-- vim.opt.termguicolors = true        -- enabl 24-bit RGB color in the TUI
vim.opt.showmode = false -- we are experienced, wo don't need the "-- INSERT --" mode hint

-- Searching
vim.opt.incsearch = true -- search as characters are entered
vim.opt.hlsearch = false -- do not highlight matches
vim.opt.ignorecase = true -- ignore case in searches by default
vim.opt.smartcase = true -- but make it case sensitive if an uppercase is entered

ç„¶åæ‰“å¼€ init.luaï¼Œç”¨ require å¯¼å…¥åˆšæ‰å†™çš„ options.lua æ–‡ä»¶

require('options')

æŒ‰é”®é…ç½®

æŒ‰é”®åŠŸèƒ½ä¸€è§ˆï¼š

    ç”¨ <C-h/j/k/l> å¿«é€Ÿåœ¨å¤šçª—å£ä¹‹é—´ç§»åŠ¨å…‰æ ‡
    ç”¨ Ctrl + æ–¹å‘é”®è¿›è¡Œçª—å£å¤§å°çš„è°ƒæ•´
    é€‰æ‹©æ¨¡å¼ä¸‹å¯ä»¥ä¸€ç›´ç”¨ Tab æˆ–è€… Shift-Tab æ”¹å˜ç¼©è¿›

æ–°å»º ~/.config/nvim/lua/keymaps.lua æ–‡ä»¶å¹¶æ”¾å…¥å¦‚ä¸‹å†…å®¹â¬‡ï¸

-- define common options
local opts = {
    noremap = true,      -- non-recursive
    silent = true,       -- do not show message
}

-----------------
-- Normal mode --
-----------------

-- Hint: see `:h vim.map.set()`
-- Better window navigation
vim.keymap.set('n', '<C-h>', '<C-w>h', opts)
vim.keymap.set('n', '<C-j>', '<C-w>j', opts)
vim.keymap.set('n', '<C-k>', '<C-w>k', opts)
vim.keymap.set('n', '<C-l>', '<C-w>l', opts)

-- Resize with arrows
-- delta: 2 lines
vim.keymap.set('n', '<C-Up>', ':resize -2<CR>', opts)
vim.keymap.set('n', '<C-Down>', ':resize +2<CR>', opts)
vim.keymap.set('n', '<C-Left>', ':vertical resize -2<CR>', opts)
vim.keymap.set('n', '<C-Right>', ':vertical resize +2<CR>', opts)

-----------------
-- Visual mode --
-----------------

-- Hint: start visual mode with the same area as the previous area and the same mode
vim.keymap.set('v', '<', '<gv', opts)
vim.keymap.set('v', '>', '>gv', opts)

ç„¶ååœ¨ init.lua æ–‡ä»¶é‡Œé¢å†æ¬¡åŠ ä¸Šä¸€è¡Œå¯¼å…¥è¿™ä¸ªæ–‡ä»¶

... -- çœç•¥å…¶ä»–è¡Œ
require('keymaps')

è­¦å‘Š
... è¡¨ç¤ºçœç•¥äº†å…¶ä»–éƒ¨åˆ†çš„ä»£ç ï¼ˆä¸ºäº†èŠ‚çœåšå®¢çš„ç¯‡å¹…ï¼‰
å®‰è£…æ’ä»¶ç®¡ç†å™¨

ä¸€ä¸ªå¼ºå¤§çš„ Nvim ç¦»ä¸å¼€æ’ä»¶çš„æ”¯æŒã€‚æˆ‘é€‰ç”¨çš„æ˜¯å½“ä¸‹æœ€ä¸ºæµè¡Œ lazy.nvimã€‚å®ƒæ”¯æŒå¦‚ä¸‹è®¸å¤šç‰¹æ€§ï¼š

    æ­£ç¡®å¤„ç†ä¸åŒæ’ä»¶ä¹‹é—´çš„ä¾èµ–
    æ”¯æŒå®šåˆ¶ Lazy loadingï¼Œæ¯”å¦‚åŸºäº Eventã€Filetype ç­‰
    â€¦

æ–°å»º ~/.config/nvim/lua/plugins.lua æ–‡ä»¶å¹¶æ”¾å…¥å¦‚ä¸‹å†…å®¹ã€‚ä¸‹é¢çš„æ¨¡æ¿åªå®Œæˆäº† lazy.nvim è‡ªèº«çš„å®‰è£…ï¼Œè¿˜æ²¡æœ‰æŒ‡å®šå…¶ä»–ç¬¬ä¸‰æ–¹æ’ä»¶

local lazypath = vim.fn.stdpath("data") .. "/lazy/lazy.nvim"
if not (vim.uv or vim.loop).fs_stat(lazypath) then
  vim.fn.system({
    "git",
    "clone",
    "--filter=blob:none",
    "https://github.com/folke/lazy.nvim.git",
    "--branch=stable", -- latest stable release
    lazypath,
  })
end
vim.opt.rtp:prepend(lazypath)

require("lazy").setup({})

    ğŸ’¡ åœ¨ lazy.nvim æŒ‡å®šç¬¬ä¸‰æ–¹æ’ä»¶å¾ˆç®€å•ï¼Œåªéœ€è¦åœ¨ require("lazy").setup({ ... }) çš„ ... é‡Œé¢å£°æ˜æ’ä»¶

ç„¶ååœ¨ init.lua æ–‡ä»¶é‡Œé¢å†æ¬¡åŠ ä¸Šä¸€è¡Œå¯¼å…¥è¿™ä¸ªæ–‡ä»¶

... -- çœç•¥å…¶ä»–è¡Œ
require('plugins')

æ­¤æ—¶ä½ é‡å¯ Nvim ä¼šå‘ç°é»‘å±æ²¡æ˜¾ç¤ºï¼Œè¿™æ˜¯å› ä¸º lazy.nvim åœ¨å®‰è£…è‡ªå·±ï¼Œé™å¾…ç‰‡åˆ»å³å¯â˜•ï¸ã€‚ç­‰å¾… Dashboard å‡ºç°ä¹‹åï¼Œå¯ä»¥è¾“å…¥ :Lazy è¯•è¯•ï¼Œå¦‚æœçœ‹åˆ°äº†å¼¹å‡ºäº† lazy.nvim çš„çª—å£ï¼Œé‚£å°±å®‰è£…æˆåŠŸäº†ğŸ‰
æŠ€å·§
Tipï¼šç”¨ :q é€€å‡º lazy.nvim çš„çª—å£
ä¸»é¢˜é…ç½®
æ³¨æ„
macOS è‡ªå¸¦çš„ Terminal.app åªæ”¯æŒ ANSI 256ï¼Œåœ¨å®‰è£…å®Œ monokai ä¸»é¢˜åï¼Œä½ å¯èƒ½ä¼šå‘ç°æ˜¾ç¤ºæ•´ä¸ªç”»é¢å˜æˆè“è‰²ã€‚ä½¿ç”¨é¢œè‰²æ”¯æŒæ›´ä¸°å¯Œçš„ Terminal å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼ˆæ¯”å¦‚ iTerm2ã€Kittyï¼‰

æˆ‘å–œæ¬¢çš„ä¸»é¢˜æ˜¯ monokai.nvimï¼Œåœ¨ plugins.lua è¿›è¡Œä¿®æ”¹

... -- çœç•¥å…¶ä»–è¡Œ
require("lazy").setup({
    "tanvirtin/monokai.nvim",
})

ä¿å­˜æ›´æ”¹å¹¶é‡å¯å°±å¯ä»¥çœ‹åˆ° lazy.nvim åœ¨å¸®æˆ‘ä»¬å®‰è£…æ’ä»¶äº†ï¼Œæ–°å»ºå¹¶ç¼–è¾‘ ~/.config/nvim/lua/colorscheme.lua æ–‡ä»¶

-- define your colorscheme here
local colorscheme = 'monokai_pro'

local is_ok, _ = pcall(vim.cmd, "colorscheme " .. colorscheme)
if not is_ok then
    vim.notify('colorscheme ' .. colorscheme .. ' not found!')
    return
end

è¿™é‡Œç”¨åˆ°çš„ pcall æ˜¯ Lua é‡Œé¢çš„ protected callï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ª bool å˜é‡è¡¨ç¤ºæ˜¯å¦æ‰§è¡ŒæˆåŠŸï¼ˆè·Ÿ Go è¯­è¨€çš„ err åŠŸèƒ½ç±»ä¼¼ï¼‰ã€‚è¿™é‡Œé‡‡ç”¨ pcall è€Œä¸æ˜¯ç›´æ¥åœ¨ init.lua æ–‡ä»¶é‡Œé¢åŠ ä¸Š vim.cmd('colorscheme monokai_pro') æ˜¯ä¸ºäº†é¿å…ä¸»é¢˜æ²¡æœ‰å®‰è£…çš„æƒ…å†µä¸‹æ‰“å¼€ Nvim çœ‹åˆ°ä¸€å¤§å †æŠ¥é”™ä¿¡æ¯2

æœ€ååœ¨ init.lua æ–‡ä»¶é‡Œé¢å¯¼å…¥å°±è¡Œ

... -- çœç•¥å…¶ä»–è¡Œ
require('colorscheme')

è‡ªåŠ¨è¡¥å…¨æŒ‡å—

è‡ªå·±æ‰‹åŠ¨é…ç½®è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½çš„è¯ä¼šæ¯”è¾ƒç¹çï¼Œæ‰€ä»¥æˆ‘ä»¬æœ€å¥½æ˜¯å€ŸåŠ©äºä¸€äº›æ’ä»¶æ¥å¸®å¿™ï¼Œä¸‹é¢æˆ‘è®²è®²æˆ‘æ‘¸ç´¢å‡ºæ¥çš„æœ€ç®€å•é…ç½®æ–¹æ³•

é¦–å…ˆï¼Œç¬¬ä¸€ä¸ªè¦ç”¨åˆ°çš„æ’ä»¶æ˜¯ nvim-cmpï¼Œå®ƒå¯ä»¥ç®¡ç†å„ç§è¡¥å…¨å€™é€‰é¡¹æ¥æºï¼Œç„¶åå±•ç¤ºåœ¨è¡¥å…¨èœå•é‡Œé¢ï¼Œè¿˜æ”¯æŒæˆ‘ä»¬å¯¹å¤–è§‚ç­‰è¿›è¡Œå®šåˆ¶åŒ–ã€‚

æˆ‘ä»¬å…ˆæ–°å»º ~/.config/nvim/lua/config/nvim-cmp.lua æ–‡ä»¶é…ç½® nvim-cmp

local has_words_before = function()
    unpack = unpack or table.unpack
    local line, col = unpack(vim.api.nvim_win_get_cursor(0))
    return col ~= 0 and vim.api.nvim_buf_get_lines(0, line - 1, line, true)[1]:sub(col, col):match("%s") == nil
end

local luasnip = require("luasnip")
local cmp = require("cmp")

cmp.setup({
    snippet = {
        -- REQUIRED - you must specify a snippet engine
        expand = function(args)
            require('luasnip').lsp_expand(args.body) -- For `luasnip` users.
        end,
    },
    mapping = cmp.mapping.preset.insert({
        -- Use <C-b/f> to scroll the docs
        ['<C-b>'] = cmp.mapping.scroll_docs( -4),
        ['<C-f>'] = cmp.mapping.scroll_docs(4),
        -- Use <C-k/j> to switch in items
        ['<C-k>'] = cmp.mapping.select_prev_item(),
        ['<C-j>'] = cmp.mapping.select_next_item(),
        -- Use <CR>(Enter) to confirm selection
        -- Accept currently selected item. Set `select` to `false` to only confirm explicitly selected items.
        ['<CR>'] = cmp.mapping.confirm({ select = true }),

        -- A super tab
        -- sourc: https://github.com/hrsh7th/nvim-cmp/wiki/Example-mappings#luasnip
        ["<Tab>"] = cmp.mapping(function(fallback)
            -- Hint: if the completion menu is visible select next one
            if cmp.visible() then
                cmp.select_next_item()
            elseif has_words_before() then
                cmp.complete()
            else
                fallback()
            end
        end, { "i", "s" }), -- i - insert mode; s - select mode
        ["<S-Tab>"] = cmp.mapping(function(fallback)
            if cmp.visible() then
                cmp.select_prev_item()
            elseif luasnip.jumpable( -1) then
                luasnip.jump( -1)
            else
                fallback()
            end
        end, { "i", "s" }),
    }),

  -- Let's configure the item's appearance
  -- source: https://github.com/hrsh7th/nvim-cmp/wiki/Menu-Appearance
  formatting = {
      -- Set order from left to right
      -- kind: single letter indicating the type of completion
      -- abbr: abbreviation of "word"; when not empty it is used in the menu instead of "word"
      -- menu: extra text for the popup menu, displayed after "word" or "abbr"
      fields = { 'abbr', 'menu' },

      -- customize the appearance of the completion menu
      format = function(entry, vim_item)
          vim_item.menu = ({
              nvim_lsp = '[Lsp]',
              luasnip = '[Luasnip]',
              buffer = '[File]',
              path = '[Path]',
          })[entry.source.name]
          return vim_item
      end,
  },

  -- Set source precedence
  sources = cmp.config.sources({
    { name = 'nvim_lsp' },    -- For nvim-lsp
    { name = 'luasnip' },     -- For luasnip user
    { name = 'buffer' },      -- For buffer word completion
    { name = 'path' },        -- For path completion
  })
})

ç„¶åæˆ‘ä»¬ä¿®æ”¹ plugins.lua æ–‡ä»¶æ·»åŠ ç›¸å…³çš„æ’ä»¶

... -- çœç•¥å…¶ä»–è¡Œ
require("lazy").setup({
	-- Vscode-like pictograms
	{
		"onsails/lspkind.nvim",
		event = { "VimEnter" },
	},
	-- Auto-completion engine
	{
		"hrsh7th/nvim-cmp",
		dependencies = {
			"lspkind.nvim",
			"hrsh7th/cmp-nvim-lsp", -- lsp auto-completion
			"hrsh7th/cmp-buffer", -- buffer auto-completion
			"hrsh7th/cmp-path", -- path auto-completion
			"hrsh7th/cmp-cmdline", -- cmdline auto-completion
		},
		config = function()
			require("config.nvim-cmp")
		end,
	},
	-- Code snippet engine
	{
		"L3MON4D3/LuaSnip",
		version = "v2.*",
	},
    ... -- çœç•¥å…¶ä»–è¡Œ
})

è§£é‡Šå¦‚ä¸‹

    cmp.setup å‡½æ•°çš„å‚æ•°æ˜¯ä¸€ä¸ª Lua çš„ Tableï¼Œç”¨äºè®¾ç½®å„ä¸ªé€‰é¡¹ï¼ˆä¸‹é¢ä¼šè§£é‡Šï¼‰ã€‚åé¢ä½ ä¼šå‘ç°å¾ˆå¤šç¬¬ä¸‰æ–¹æ’ä»¶éƒ½ç”¨ setup ä¼ å…¥ä¸€ä¸ª Lua table çš„æ–¹å¼è¿›è¡Œé…ç½®ï¼Œè¿™ä¸ªæ˜¯ Nvim çš„ Lua æ’ä»¶çš„æƒ¯ä¾‹
    LuaSnip æ˜¯ code snippet å¼•æ“ï¼Œå› ä¸ºnvim-cmp è¦æ±‚æˆ‘ä»¬å¿…é¡»æŒ‡å®šè‡³å°‘ä¸€ä¸ª code snippet å¼•æ“æ¥æºã€‚ä½ æš‚æ—¶ç”¨ä¸åˆ°å½“å®ƒä¸å­˜åœ¨ä¹Ÿæ²¡æœ‰å…³ç³»
    lazy.nvim æ”¯æŒç”¨ config = function() ... end æŒ‡å®šå¯¹åº”æ’ä»¶è¢«åŠ è½½ä¹‹åè¦è¿è¡Œçš„ä»£ç ï¼Œè¿™é‡Œæˆ‘ä»¬æ˜¯è®© Lua å¯¼å…¥å‰é¢å†™å¥½çš„ nvim-cmp.lua é…ç½®æ–‡ä»¶
    ä¸è¦è¢«ä¸Šé¢çš„è¿™ä¹ˆå¤šæ’ä»¶å“åˆ°ï¼Œnvim-cmp ä¸ºä¸»ï¼Œå…¶ä»– cmp-... çš„æ’ä»¶æ˜¯ç”¨äºåœ¨å€™é€‰é¡¹æ¥æºå’Œ nvim-cmp ä¹‹é—´äº¤äº’ï¼Œlspkind.nvim æ˜¯ç¾åŒ–ç”¨çš„

nvim-cmp é‡Œé¢çš„æŒ‰é”®æ˜ å°„

æŒ‰é”®æ˜ å°„ç”¨çš„æ˜¯ mapping = ... ï¼Œæ¯ä¸ªæŒ‰é”®ç»‘å®šçš„æ ¼å¼æ˜¯ ['<key-binding>'] = cmp.mapping.xxx,ï¼Œä¸åŒçš„ cmp.mapping.xxx çš„å«ä¹‰å¯ä»¥ç”¨ :h æŸ¥çœ‹ã€‚å¦‚æœä½ æƒ³è¦ç”¨å…¶ä»–çš„æŒ‰é”®ï¼Œåªè¦ä¿®æ”¹ [...] é‡Œé¢çš„æŒ‰é”®å³å¯

æŒ‰ç…§æˆ‘çš„ä¸ªäººä¹ æƒ¯ï¼Œè®¾ç½®äº†

    <C-k/j> æˆ–è€… <Tab>/<Shift-Tab> åœ¨å„ç§å€™é€‰é¡¹é‡Œé¢ç§»åŠ¨
    <C-b/f> åœ¨å€™é€‰é¡¹çš„æ–‡æ¡£é‡Œé¢ç§»åŠ¨
    <CR> ä¹Ÿå°±æ˜¯å›è½¦é”®ç¡®å®šè¡¥å…¨

nvim-cmp é‡Œé¢çš„è¡¥å…¨èœå•

è¡¥å…¨èœå•çš„å®šåˆ¶åŒ–ç”¨çš„æ˜¯ formatting = ...

    fields å­—æ®µè§„å®šäº†æ¯ä¸ªå€™é€‰é¡¹è¦æ˜¾ç¤ºä»€ä¹ˆä¸œè¥¿
    format = function(...) è®¾ç½®äº†ä¸åŒçš„å€™é€‰é¡¹çš„æ¥æºæ˜¾ç¤ºï¼Œåœ¨ sources = ... é‡Œé¢å£°æ˜æ¥æº

    ğŸ™ï¸ åˆ°è¿™ä¸ºæ­¢ï¼Œé‡æ–°å¯åŠ¨ Nvim åï¼Œç­‰å¾…æ’ä»¶å®‰è£…å®Œæˆååº”è¯¥å°±èƒ½å¤Ÿç”¨åˆæ­¥çš„è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½äº†ï½

LSP

è¦æŠŠ Nvim å˜æˆ IDE å°±åŠ¿å¿…è¦å€ŸåŠ©äº LSP3ï¼Œè‡ªå·±å®‰è£…å’Œé…ç½® LSP æ˜¯æ¯”è¾ƒç¹ççš„ã€‚ä¸åŒçš„ LSP å®‰è£…æ–¹æ³•ä¸åŒï¼Œä¹Ÿä¸æ–¹ä¾¿åç»­ç®¡ç†ã€‚mason.nvim å’Œé…å¥—çš„ mason-lspconfig.nvim è¿™ä¸¤ä¸ªæ’ä»¶å¾ˆå¥½è§£å†³äº†è¿™ä¸ªé—®é¢˜ ğŸ¤—

é¦–å…ˆä¿®æ”¹ plugins.lua æ–‡ä»¶ï¼Œå¢åŠ å¯¹åº”çš„æ’ä»¶

... -- çœç•¥å…¶ä»–è¡Œ
require("lazy").setup({
	-- LSP manager
	"williamboman/mason.nvim",
	"williamboman/mason-lspconfig.nvim",
	"neovim/nvim-lspconfig",
    ... -- çœç•¥å…¶ä»–è¡Œ
})

æ–°å»ºä¸€ä¸ª ~/.config/nvim/lua/lsp.lua æ–‡ä»¶å¹¶ç¼–è¾‘ï¼Œé¦–å…ˆé…ç½® mason å’Œ mason-lspconfig

require('mason').setup({
    ui = {
        icons = {
            package_installed = "âœ“",
            package_pending = "âœ",
            package_uninstalled = "âœ—"
        }
    }
})

require('mason-lspconfig').setup({
    -- A list of servers to automatically install if they're not already installed
    ensure_installed = { 'pylsp', 'lua_ls', 'rust_analyzer' },
})

    ğŸ’¡ æˆ‘ä»¬æƒ³è¦ç”¨ä»€ä¹ˆè¯­è¨€çš„ LSP å°±åœ¨ ensure_installed é‡Œé¢åŠ ä¸Šï¼Œå®Œæ•´çš„åˆ—è¡¨å¯ä»¥çœ‹ server_configurationsã€‚æˆ‘ä¸ªäººå¸¸ç”¨çš„å°± python/rust è¿™ä¸¤ä¸ªç¼–ç¨‹è¯­è¨€ï¼Œè€Œå› ä¸ºæˆ‘ä»¬éƒ½ç”¨ Lua è¯­è¨€æ¥é…ç½® Nvimï¼Œæ‰€ä»¥ä¹ŸåŠ ä¸Šäº† lua_ls

é…ç½®å¥½ mason-lspconfig ä¹‹åï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥é…ç½® nvim-lspconfig äº†ã€‚å› ä¸ºé…ç½®çš„ä»£ç æ¯”è¾ƒé•¿ï¼Œä¸‹é¢åªå±•ç¤ºäº† pylsp çš„é…ç½®ï¼Œå…¶ä»–è¯­è¨€çš„é…ç½®å¤§åŒå°å¼‚ã€‚å¦‚æœæœ‰ç–‘æƒ‘ï¼Œå¯ä»¥æŸ¥çœ‹è¯¥æ–‡ä»¶çš„æœ€æ–°ç‰ˆæœ¬

    ğŸ’¡ æ¯ä¸ª LSP éƒ½å­˜åœ¨è‡ªå·±å¯ä»¥é…ç½®çš„é€‰é¡¹ï¼Œä½ å¯ä»¥è‡ªå·±å»å¯¹åº” LSP çš„ GitHub ä»“åº“æŸ¥é˜…æ›´å¤šä¿¡æ¯ã€‚å¦‚æœè¦ç”¨é»˜è®¤é…ç½®çš„è¯ï¼ŒåŸºæœ¬ä¸Šæ¯ä¸€ä¸ªæ–°çš„è¯­è¨€éƒ½åªéœ€è¦è®¾ç½® on_attach = on_attach

ç¼–è¾‘ ~/.config/nvim/lua/lsp.lua æ–‡ä»¶æ–°å¢å¦‚ä¸‹å†…å®¹

... -- çœç•¥å…¶ä»–è¡Œ
-- Set different settings for different languages' LSP
-- LSP list: https://github.com/neovim/nvim-lspconfig/blob/master/doc/server_configurations.md
-- How to use setup({}): https://github.com/neovim/nvim-lspconfig/wiki/Understanding-setup-%7B%7D
--     - the settings table is sent to the LSP
--     - on_attach: a lua callback function to run after LSP atteches to a given buffer
local lspconfig = require('lspconfig')

-- Customized on_attach function
-- See `:help vim.diagnostic.*` for documentation on any of the below functions
local opts = { noremap = true, silent = true }
vim.keymap.set('n', '<space>e', vim.diagnostic.open_float, opts)
vim.keymap.set('n', '[d', vim.diagnostic.goto_prev, opts)
vim.keymap.set('n', ']d', vim.diagnostic.goto_next, opts)
vim.keymap.set('n', '<space>q', vim.diagnostic.setloclist, opts)

-- Use an on_attach function to only map the following keys
-- after the language server attaches to the current buffer
local on_attach = function(client, bufnr)
    -- Enable completion triggered by <c-x><c-o>
    vim.api.nvim_buf_set_option(bufnr, 'omnifunc', 'v:lua.vim.lsp.omnifunc')

    -- See `:help vim.lsp.*` for documentation on any of the below functions
    local bufopts = { noremap = true, silent = true, buffer = bufnr }
    vim.keymap.set('n', 'gD', vim.lsp.buf.declaration, bufopts)
    vim.keymap.set('n', 'gd', vim.lsp.buf.definition, bufopts)
    vim.keymap.set('n', 'K', vim.lsp.buf.hover, bufopts)
    vim.keymap.set('n', 'gi', vim.lsp.buf.implementation, bufopts)
    vim.keymap.set('n', '<C-k>', vim.lsp.buf.signature_help, bufopts)
    vim.keymap.set('n', '<space>wa', vim.lsp.buf.add_workspace_folder, bufopts)
    vim.keymap.set('n', '<space>wr', vim.lsp.buf.remove_workspace_folder, bufopts)
    vim.keymap.set('n', '<space>wl', function()
        print(vim.inspect(vim.lsp.buf.list_workspace_folders()))
    end, bufopts)
    vim.keymap.set('n', '<space>D', vim.lsp.buf.type_definition, bufopts)
    vim.keymap.set('n', '<space>rn', vim.lsp.buf.rename, bufopts)
    vim.keymap.set('n', '<space>ca', vim.lsp.buf.code_action, bufopts)
    vim.keymap.set('n', 'gr', vim.lsp.buf.references, bufopts)
    vim.keymap.set("n", "<space>f", function()
        vim.lsp.buf.format({ async = true })
    end, bufopts)
end

-- Configure each language
-- How to add LSP for a specific language?
-- 1. use `:Mason` to install corresponding LSP
-- 2. add configuration below
lspconfig.pylsp.setup({
	on_attach = on_attach,
})

ä¸Šé¢çš„æŒ‰é”®ç»‘å®šçš„æ„æ€æ˜¯å¾ˆç›´è§‚çš„ï¼Œè¿™é‡Œå°±ä¸å¤šè§£é‡Šå•¦

æœ€ååœ¨ init.lua æ–‡ä»¶é‡Œé¢åŠ ä¸Š

... -- çœç•¥å…¶ä»–è¡Œ
require('lsp')

é‡å¯ Nvim ä¹‹åï¼Œä½ åº”è¯¥å¯ä»¥åœ¨ä¸‹é¢çš„çŠ¶æ€æ çœ‹åˆ° Mason æ­£åœ¨ä¸‹è½½å¹¶å®‰è£…å‰é¢æˆ‘ä»¬æŒ‡å®šçš„ LSPï¼ˆæ³¨æ„æ­¤æ—¶ä¸èƒ½å…³é—­ Nvimï¼‰ï¼Œå¯ä»¥è¾“å…¥ :Mason æŸ¥çœ‹å®‰è£…è¿›åº¦ã€‚åœ¨ä½ ç­‰å¾…å®‰è£…çš„è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥è¾“å…¥ g? æŸ¥çœ‹æ›´å¤šå¸®åŠ©ä¿¡æ¯äº†è§£å¦‚ä½•ä½¿ç”¨ mason æ’ä»¶

å¤§åŠŸå‘ŠæˆğŸ‰ğŸ‰ğŸ‰
æ€»ç»“

è¿™æ ·é…ç½®ä¸‹æ¥ï¼Œæˆ‘ä»¬æˆåŠŸæŠŠ Nvim å˜æˆäº†ä¸€ä¸ªè½»é‡çº§çš„ IDEï¼Œå®ƒæ”¯æŒä»£ç é«˜äº®ã€ä»£ç è¡¥å…¨ã€è¯­æ³•æ£€æŸ¥ç­‰åŠŸèƒ½ï¼Œè€Œä¸”æ˜¯å®Œå…¨å¼€æºå…è´¹çš„ï¼Œè™½ç„¶è¿˜æœ‰äº›ç®€é™‹ï¼Œä½†å·²ç»æ˜¯å¯ä»¥ç”¨çš„äº† ğŸ¤—

æˆ‘å‘ç°è‡ªä»å­¦äº† Vim ä¹‹åï¼Œæˆ‘æ€»åœ¨å…¶ä»–å„ç§ä»£ç ç¼–è¾‘å™¨ã€IDE çœ‹æ˜¯ä¸æ˜¯æ”¯æŒ Vimã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå®ƒä»¬å¯¹ Vim çš„æ”¯æŒéƒ½ä¸æ˜¯å¾ˆè®©äººæ»¡æ„ï¼Œè¿˜å®¹æ˜“æœ‰å¿«æ·é”®å†²çªç­‰é—®é¢˜ã€‚å› æ­¤æˆ‘é€‰æ‹©å°† Nvim å˜æˆ IDEï¼Œå¹¶å°†é…ç½®æ–‡ä»¶æ‰˜ç®¡åœ¨æˆ‘çš„ Martinlwx/dotfiles ä¸Šã€‚è¿™æ ·åœ¨æ–°çš„æœºå™¨ä¸Šåªè¦å®‰è£…å¥½ Nvim å¹¶å…‹éš†é…ç½®ï¼Œé™å¾…ç‰‡åˆ»ä¹‹åå°±å¯ä»¥åœ¨ä¸åŒçš„æœºå™¨ä¸Šè·å¾—ä¸€æ ·çš„ç¼–ç¨‹ä½“éªŒ

æ‰“ç£¨å®šåˆ¶åŒ–å·¥å…·æ˜¯éœ€è¦ä»˜å‡ºä¸€å®šç²¾åŠ›çš„ã€‚ä¸ºäº†ç†è§£æ¯ä¸ªé€‰é¡¹éƒ½åœ¨å¹²å•¥ï¼Œæˆ‘ä¸å¾—ä¸æŸ¥æ‰¾å„ç§èµ„æ–™ã€‚ä½†æˆ‘ä»ç›¸ä¿¡è¿™æ˜¯å€¼å¾—çš„ï¼Œç†è§£ä½ çš„å·¥å…·åˆ©äºä½ åšæ‰©å±•å’Œå®šåˆ¶åŒ–ã€‚æœ¬æ–‡å·²ç»å°½å¯èƒ½é‡‡ç”¨äº†æ¯”è¾ƒç®€å•çš„é…ç½®ï¼Œè¿˜æœ‰å¾ˆå¤šç¾åŒ–ã€ç§äººå®šåˆ¶åŒ–çš„å†…å®¹å¯ä»¥é…ç½®ï¼Œæ›´åˆ«æå…¶ä»–å¾ˆå¤šä¼˜ç§€çš„ç¬¬ä¸‰æ–¹æ’ä»¶éƒ½è¿˜æ²¡æœ‰æåŠï¼Œè¿™äº›å°±ç•™ç»™è¯»è€…è‡ªå·±å»æ¢ç´¢å‘ç°äº†
å‚è€ƒ

    Installing-Neovim â†©ï¸

    Adding a colorscheme/theme â†©ï¸

    Language Server Protocol - Wiki â†©ï¸
s
